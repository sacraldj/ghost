# üöÄ GHOST Position Exit Tracker v2.0 - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –ë—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
cp position_exit_tracker.py position_exit_tracker_v1.4_backup.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
python3 -c "import yaml, pybit, json, datetime"
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
ls -la config/api_keys.yaml
```

### 3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
mkdir -p config
echo "bybit:\n  api_key: \"test_key\"\n  api_secret: \"test_secret\"" > config/api_keys.yaml

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
python3 test_position_exit_tracker.py
```

### 4. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# –ù–æ–≤—ã–π —Ñ–∞–π–ª —É–∂–µ –≥–æ—Ç–æ–≤
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
python3 position_exit_tracker.py
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:
```bash
# –ù–æ–≤—ã–µ trace-–∫–æ–¥—ã
tail -f logs/ghost.log | grep "FILLS_"

# –£—Å–ø–µ—à–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã
grep "FILLS_CALC_OK" logs/ghost.log

# Fallback —Å–ª—É—á–∞–∏
grep "FALLBACK_CALC_USED" logs/ghost.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ –ë–î
sqlite3 ghost_news.db "SELECT roi_source, pnl_source, exit_detail FROM trades ORDER BY id DESC LIMIT 5;"
```

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã

### 1. –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –Ω–µ –∏–∑–º–µ–Ω—ë–Ω
- ‚úÖ Fallback —Ä–µ–∂–∏–º –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏

### 2. –ù–æ–≤—ã–µ –ø–æ–ª—è
- `roi_source`: "fills" | "fallback"
- `pnl_source`: "fills" | "fallback"
- `exit_detail`: "fills: tp1@50% + be@50%"
- `pnl_tp1_net`, `pnl_rest_net`: –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –Ω–æ–≥–∞–º

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- API –∑–∞–ø—Ä–æ—Å—ã: ‚â§ 2/—Å–µ–∫
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è: –ª–∏–º–∏—Ç 10000 fills
- –í—Ä–µ–º—è –æ–∫–Ω–∞: ¬±5 –º–∏–Ω—É—Ç –æ—Ç —Å–¥–µ–ª–∫–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã:
```bash
python3 test_position_exit_tracker.py
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ fills-first –ª–æ–≥–∏–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ fallback —Ä–µ–∂–∏–º–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –£–ª—É—á—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏:
- **PnL —Ä–∞—Å—á—ë—Ç**: –û—Ç –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º—É
- **–ö–æ–º–∏—Å—Å–∏–∏**: –û—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫ —Ä–µ–∞–ª—å–Ω—ã–º
- **TP1/TP2 —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: –û—Ç —Ñ–ª–∞–≥–æ–≤ –∫ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º fills
- **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è**: –û—Ç –±–∞–∑–æ–≤–æ–π –∫ –ø–æ–ª–Ω–æ–π

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –Ω–µ –∏–∑–º–µ–Ω—ë–Ω
- ‚úÖ Fallback —Ä–µ–∂–∏–º –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

## üö® –û—Ç–∫–∞—Ç

–í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º:
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é
cp position_exit_tracker_v1.4_backup.py position_exit_tracker.py

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
python3 position_exit_tracker.py
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- `FILLS_FETCH_OK`: –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ fills
- `FILLS_CALC_OK`: –£—Å–ø–µ—à–Ω—ã–π —Ä–∞—Å—á—ë—Ç
- `FALLBACK_CALC_USED`: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω fallback
- `FILLS_VS_API_MISMATCH`: –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å API

### –ö–æ–Ω—Ç–∞–∫—Ç—ã:
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `POSITION_EXIT_TRACKER_V2_DOCUMENTATION.md`
- Changelog: `POSITION_EXIT_TRACKER_V2_CHANGELOG.md`
- –¢–µ—Å—Ç—ã: `test_position_exit_tracker.py`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ  
**–í–µ—Ä—Å–∏—è:** v2.0  
**–î–∞—Ç–∞:** 2025-01-27
