# üìä GHOST Database Schema - Columns After Signal Full Audit

**–°—Ç–∞—Ç—É—Å:** üü¢ ready-to-build  
**–í–µ—Ä—Å–∏—è:** v1.1  
**–ï–¥–∏–Ω–∞—è –ë–î:** ghost.db  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –°—Ç—Ä–æ–≥–æ –∫–∞–∫ –≤ position_exit_tracker.py

## üîç –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### ‚úÖ –ß—Ç–æ –£–ñ–ï –ï–°–¢–¨ –≤ —Å–∏—Å—Ç–µ–º–µ:
1. **signals_parsed** - —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç signals
2. **trades** - –±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è, –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å
3. **trader_registry** - —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç traders
4. **candles_cache** - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å
5. **market_snapshots** - –µ—Å—Ç—å –≤ Supabase —Å—Ö–µ–º–µ
6. **performance_analytics** - –µ—Å—Ç—å –≤ Supabase —Å—Ö–µ–º–µ

### ‚ùå –ß—Ç–æ –û–¢–°–£–¢–°–¢–í–£–ï–¢ –∏ –Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å:

#### 1. **trade_events** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!
- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ —Å–¥–µ–ª–∫–µ
- –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–∞—Å–∞–Ω–∏–π TP1, TP2, SL, BE
- –ù—É–∂–Ω–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞

#### 2. **trade_audits** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ!
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞—É–¥–∏—Ç –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏
- MAE/MFE –∞–Ω–∞–ª–∏–∑
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π TP

#### 3. **strategies** - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

#### 4. **strategy_results** - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –ö—ç—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º
- –ü–µ—Ä–µ—Å—á—ë—Ç ROI –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

#### 5. **trader_stats** - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç—Ä–µ–π–¥–µ—Ä–∞–º
- –ü–æ –ø–µ—Ä–∏–æ–¥–∞–º –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º

#### 6. **candles_cache** - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é
- –ö—ç—à —Å–≤–µ—á–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- –ù—É–∂–Ω–æ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ —Å–¥–µ–ª–æ–∫

## üöÄ –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
sqlite3 ghost.db < db/migrate_to_ghost_full_schema.sql
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API endpoints
- –û–±–Ω–æ–≤–∏—Ç—å `/api/traders-analytics/list` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π —Å—Ö–µ–º–æ–π
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É strategy_id –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å trader_stats —Ç–∞–±–ª–∏—Ü–µ–π

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

#### 3.1 Signal Processor (–æ–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
```python
# core/signal_processor_v2.py
class SignalProcessorV2:
    def process_raw_signal(self, raw_message):
        # –ü–∞—Ä—Å–∏–Ω–≥ –≤ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É signals
        # –° –ø–æ–ª—è–º–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
        pass
```

#### 3.2 Trade Executor (–Ω–æ–≤—ã–π)
```python
# core/trade_executor.py
class TradeExecutor:
    def execute_paper_trade(self, signal_id, strategy_id):
        # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ trades
        # –° –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º mode='paper'
        pass
    
    def record_trade_event(self, trade_id, event_type, price):
        # –ó–∞–ø–∏—Å—å –≤ trade_events
        pass
```

#### 3.3 Trade Auditor (–Ω–æ–≤—ã–π)
```python
# core/trade_auditor.py
class TradeAuditor:
    def audit_trade(self, trade_id):
        # –ê–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –∏–∑ trade_events
        # –†–∞—Å—á—ë—Ç MAE/MFE
        # –ó–∞–ø–∏—Å—å –≤ trade_audits
        pass
```

#### 3.4 Strategy Simulator (–Ω–æ–≤—ã–π)
```python
# core/strategy_simulator.py
class StrategySimulator:
    def simulate_strategy(self, trade_id, strategy_id):
        # –°–∏–º—É–ª—è—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
        # –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ strategy_results
        pass
```

#### 3.5 Stats Aggregator (–Ω–æ–≤—ã–π)
```python
# core/stats_aggregator.py
class StatsAggregator:
    def update_trader_stats(self, trader_id, period_key, strategy_id):
        # –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ strategy_results
        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ trader_stats
        pass
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### 4.1 TradersAnalyticsDashboard
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ VIEW
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å vw_trader_ranking
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º

#### 4.2 API Endpoints
```typescript
// –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ endpoints
GET /api/traders-analytics/list?strategy_id=tp2_sl_be
GET /api/traders-analytics/summary?strategy_id=scalping
GET /api/traders-analytics/chart?strategy_id=swing
```

## üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üî• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **trade_events** - –±–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞—É–¥–∏—Ç
2. **trade_audits** - –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ MAE/MFE
3. **strategies** - –±–∞–∑–∞ –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

### ‚ö° –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
4. **strategy_results** - –∫—ç—à –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
5. **trader_stats** - –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
6. **candles_cache** - –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏

### üìä –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
7. **scenarios/scenario_results** - what-if –∞–Ω–∞–ª–∏–∑
8. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ VIEW –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∞—Ç JSON –ø–æ–ª–µ–π:
```json
// targets_json
["45000", "46000", "47000"]

// tp_hits_json
{
  "tp1": {"hit": true, "time": 1692168000000, "price": "45000"},
  "tp2": {"hit": false, "time": null, "price": "46000"}
}

// params_json –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
{
  "tp1_portion": 0.5,
  "tp2_portion": 0.5,
  "be_after_tp1": true,
  "max_duration": 86400
}
```

### –†–∞—Å—á—ë—Ç ROI (–∫–∞–∫ –≤ position_exit_tracker.py):
```python
def calculate_roi(pnl_net, margin_used):
    return (pnl_net / margin_used) * 100 if margin_used > 0 else 0
```

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç:

1. ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –î–∞—Ä—ç–Ω–∞**
2. ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å ROI –ø–æ —Ä–∞–∑–Ω—ã–º —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º**
3. ‚úÖ **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏**
4. ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é $100 –º–∞—Ä–∂–∏ –Ω–∞ —Å–∏–≥–Ω–∞–ª**
5. ‚úÖ **–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω–æ–µ ROI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**
6. ‚úÖ **–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç—Ä–µ–π–¥–µ—Ä–∞–º –∏ –ø–µ—Ä–∏–æ–¥–∞–º**

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—É—é —Å—Ö–µ–º—É
sqlite3 ghost.db < db/ghost_full_schema.sql

# 2. –ò–ª–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é
sqlite3 ghost.db < db/migrate_to_ghost_full_schema.sql

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
sqlite3 ghost.db ".tables"
sqlite3 ghost.db "SELECT * FROM strategies;"
```

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏! üéâ**
